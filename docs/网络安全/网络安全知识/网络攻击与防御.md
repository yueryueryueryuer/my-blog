# 网络攻击与防御

## 网络攻击生命周期

### 阶段一：侦察

第一阶段在于确定潜在目标满足攻击者实施入侵的条件（例如具备理想的经济收益、有针对性地获取敏感信息或者造成品牌损害）。一旦确定了现有防御机制之后，攻击者将据此选择自己的攻击武器——具体包括利用零日安全漏洞、实施鱼叉式网络钓鱼活动或者收买贿赂内部员工等等。

### 阶段二：初步入侵

在初步入侵当中，攻击者通常会绕过边界防御机制并通过存在安全漏洞的系统或者用户帐户访问机制渗透至内部网络当中。

### 阶段三：命令与控制

已遭入侵的设备随后会被作为接入组织内部的跳板。一般来讲，攻击者会利用其下载并安装远程访问木马（简称 RAT），以便建立针对目标环境的持久性长期远程访问能力。

### 阶段四：横向移动

一旦攻击者与内部网络建立起连接，其即会试图危害其它系统及用户帐户。攻击者通常会冒充授权用户，因此安全方案将很难发现系统遭遇入侵的证据。

### 阶段五：目标达成

在这一阶段当中，攻击者通常已经建立起多个远程访问入口点，并可能已经成功入侵了数百（甚至数千）套内部系统及用户帐户。他们深入了解 IT 环境中的各方面状况，并能够顺利实现自己的恶意目标。

### 阶段六：渗透、破坏与中断

如果未能有效扼止恶意活动，企业将在最终阶段中遭受严重的经济损失。在此阶段中，攻击者将逐步实现其任务的终极目标，包括窃取知识产权或其它敏感数据、破坏关键性任务系统并常常会中断您的正常业务运营。

[以下内容摘自博客](https://blog.csdn.net/qq_37865996/article/details/85138475)

## 隐藏攻击者的地址和身份

- IP 地址欺骗或盗用技术：源 IP 地址为假冒或虚假
- MAC 地址盗用技术：修改注册表或使用 ifconfig 命令
- 通过 Proxy 隐藏技术：作为攻击跳板；实际上很难真正实现隐藏
- 网络地址转换技术：私有 IP 地址可以隐藏内部网络拓扑结构
- 盗用他人网络账户技术：网络安全链路中最薄弱的链接

## 踩点技术（Footprinting）

踩点是使用合法工具，获取公开信息的一种方式。

### 踩点所得到的有价值信息

- 信息名称：简单说明
- 网页信息：包括联系方式、合作伙伴、公司业务情况等较直观的信息
- 域名信息：包括域名服务器、网管联系人、邮件服务器以及其他应用服务器的注册信息
- 网络块：公司注册的 IP 地址范围
- 网络结构：初步探测目标网络的拓扑结构，包括防火墙位置等
- 路径信息：目标系统的网络路由信息
- 其他：包括一些非常规手段得到的有价值信息，社会工程学

### 踩点常用的工具和方法

- 直接利用浏览器获取信息
- 使用命令行方式的踩点工具：Finger（TCP 79）：账号信息、Nslookup：经典的 DNS 测试工具、Ping：测试网络畅通与否
- 借助 Sniffer Pro 4.5 协议分析工具
- Traceroute(Tracert)：跟踪路由信息，往往倒数第二个的路由信息就是目的端网关

### 踩点对策

- 层次结构的 DNS 分布:
  DMZ 中放置 www、FTP、E-mail、外部 DNS 服务器等。i）外部 DNS 服务器只提供 Internet 卡访问的域名解析服务，而通过防火墙对外隔绝内部主机的所有域名信息；ii）内部网络中有另一个 DNS 服务器提供对内的域名解析服务。两者扮演的角色不同，DMZ 的 DNS 服务器扮演转发器就可以限制内部 DNS 服务器直接向外发送域名解析请求，内部 DNS 服务器配置其“转发”选项，使得自身无法解析的域名请求被转发到 DMZ 中的 DNS 服务器。

- 限制区域文件传输

## 扫描技术（Scanning）

扫描的**目的**在于获得一些安全敏感信息和安全漏洞信息

扫描技术有：`主机扫描`、`端口扫描`、`操作系统探测`、`漏洞扫描`、`Banner获取`、`IP地址欺骗扫描`、`FTP反弹式扫描`。

### 主机扫描（Host Scanning）

一般使用 Ping 实现：发送 ICMP echo 请求给目标主机，若收到应答则表明目标主机激活。使用 Fping 工具因其“并行轮转、多线程”的特点发送大量 Ping 请求，可加快扫描速度。防火墙的存在使得 Ping 扫描的应答可能丢失，扫描结果不一定准确。

### 端口扫描（Port Scanning）

端口扫描的目标是获得目标主机开放的 TCP 和 UDP 端口列表，确定主机上开放的网络服务，得到监听端口返回的 Banner 信息。

端口扫描策略：

- 随机端口扫描（Random Port Scan）
- 慢扫描（Slow Scan）
- 分片扫描（Fragmentation Scanning）将过滤特征分开，过滤设备因无法测试标志位，会忽略后续分片包，从而绕过成功。
- 诱骗（Decoy）：所有进入分组的 TTL 值相同则认为来自同一主机，使用 Nmap，随机产生介于 51 ～ 64 的 TTL 值的分组，使 IDS 无法判断。

### 操作系统探测（Operate System Probing）

- 被动探测
- 主动探测：利用系统旗标（Banner）信息、TCP 栈指纹探测（Stack Fingerprinting）、ICMP Fingerprinting、利用 Ping 进行探测（TTL 接近 256，则是 Solaris/BSD 系统；TTL 接近 128，则是 Windows 系统；TTL 接近 64，则是 Linux 系统）

### 漏洞扫描（Hole Scanning）

漏洞（脆弱性，Vulnerability）计算机或网络系统具有的某种可能被入侵者恶意利用的特性。

针对特定应用和服务（如操作系统、Web 服务器、数据库服务器、防火墙、路由器）查找目标网络漏洞，并抽取有效账号或导出资源名

### Banner 获取

banner 信息来表示欢迎语，其中会包含一些敏感信息，所以获取 banner 也属于信息搜集的范畴。在渗透测试中，典型的 4xx、5xx 信息泄露就属于 banner 泄露的一种。在 banner 信息中，可以获取到软件开发商、软件名称、服务类型、版本号等。而版本号有时候就会存在公开的 CVE 问题，可以直接进行利用。

**前提条件**：需要和目标建立链接，只有建立了链接，我们才能获取对应的 banner 信息

**工具**：nc、scapy、nmap、dmitry、amap 等

### IP 地址欺骗扫描

我们可以使用 IP 及 MAC 地址欺骗，达到让目标主机误认为是在利用诱饵扫描，而不是一个真实的扫描，这样可以躲避防火墙和某些规则，也可以达到隐藏自身的目的

**工具**：nmap、Kali、Bt5

### FTP 反弹式扫描
